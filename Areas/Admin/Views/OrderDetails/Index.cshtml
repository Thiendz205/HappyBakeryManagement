@model List<HappyBakeryManagement.DTO.OrderDetailsDTO>

@{
    Layout = "/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";
    ViewData["Title"] = "Danh sách chi tiết đơn hàng";

    int currentPage = ViewBag.CurrentPage ?? 1;
    int totalPages = ViewBag.TotalPages ?? 1;
}

<div class="main-container">
    <h2>📋 Danh sách chi tiết đơn hàng</h2>

    <!-- 🔍 Tìm kiếm -->
    <form asp-action="Index" method="get" class="search-form row mb-3">
        <div class="col-md-4">
            <input type="text" name="customerName" class="form-control" placeholder="👤 Tên khách hàng" value="@ViewBag.CustomerName" />
        </div>
        <div class="col-md-4">
            <input type="text" name="productName" class="form-control" placeholder="🍰 Tên sản phẩm" value="@ViewBag.ProductName" />
        </div>
        <div class="col-md-4 d-flex gap-2">
            <button type="submit" class="btn btn-primary flex-fill">Tìm kiếm</button>
            <a asp-action="Index" class="btn btn-secondary flex-fill">🔄 Làm mới</a>
        </div>
    </form>

    <!-- 📦 Bảng -->
    <table class="table-style">
        <thead>
            <tr>
                <th>#</th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortColumn="OrderCode"
                       asp-route-sortOrder="@(ViewBag.SortColumn == "OrderCode" && ViewBag.SortOrder == "asc" ? "desc" : "asc")"
                       class="sortable">
                        Mã đơn hàng
                        @if (ViewBag.SortColumn == "OrderCode")
                        {
                            <span>@(ViewBag.SortOrder == "asc" ? "▲" : "▼")</span>
                        }
                    </a>
                </th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortColumn="CustomerName"
                       asp-route-sortOrder="@(ViewBag.SortColumn == "CustomerName" && ViewBag.SortOrder == "asc" ? "desc" : "asc")"
                       class="sortable">
                        Khách hàng
                        @if (ViewBag.SortColumn == "CustomerName")
                        {
                            <span>@(ViewBag.SortOrder == "asc" ? "▲" : "▼")</span>
                        }
                    </a>
                </th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortColumn="ProductName"
                       asp-route-sortOrder="@(ViewBag.SortColumn == "ProductName" && ViewBag.SortOrder == "asc" ? "desc" : "asc")"
                       class="sortable">
                        Sản phẩm
                        @if (ViewBag.SortColumn == "ProductName")
                        {
                            <span>@(ViewBag.SortOrder == "asc" ? "▲" : "▼")</span>
                        }
                    </a>
                </th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortColumn="Quantity"
                       asp-route-sortOrder="@(ViewBag.SortColumn == "Quantity" && ViewBag.SortOrder == "asc" ? "desc" : "asc")"
                       class="sortable">
                        Số lượng
                        @if (ViewBag.SortColumn == "Quantity")
                        {
                            <span>@(ViewBag.SortOrder == "asc" ? "▲" : "▼")</span>
                        }
                    </a>
                </th>
                <th>
                    <a asp-action="Index"
                       asp-route-sortColumn="TotalAmount"
                       asp-route-sortOrder="@(ViewBag.SortColumn == "TotalAmount" && ViewBag.SortOrder == "asc" ? "desc" : "asc")"
                       class="sortable">
                        Tổng tiền
                        @if (ViewBag.SortColumn == "TotalAmount")
                        {
                            <span>@(ViewBag.SortOrder == "asc" ? "▲" : "▼")</span>
                        }
                    </a>
                </th>
                <th>Hành động</th>
            </tr>
        </thead>
        <tbody>
            @if (Model != null && Model.Any())
            {
                int index = (currentPage - 1) * 10 + 1;
                foreach (var item in Model)
                {
                    <tr>
                        <td>@index</td>
                        <td>@item.OrderCode</td>
                        <td>@item.CustomerName</td>
                        <td>@item.ProductName</td>
                        <td>@item.Quantity</td>
                        <td>@(item.TotalAmount.HasValue? item.TotalAmount.Value.ToString("N0") + " đ" : "-")</td>
                        <td>
                            <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-edit">✏️ Sửa</a>
                            <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-delete"
                               onclick="return confirm('Xác nhận xóa chi tiết này?')">🗑️ Xóa</a>
                        </td>
                    </tr>
                    index++;
                }
            }
            else
            {
                <tr>
                    <td colspan="7" class="text-center">Không có chi tiết đơn hàng nào.</td>
                </tr>
            }
        </tbody>
    </table>

    <!-- 🔹 Phân trang -->
    <div class="pagination">
        @if (currentPage > 1)
        {
            <a asp-action="Index" asp-route-page="@(currentPage - 1)" class="page-btn">« Trước</a>
        }

        <span>Trang @currentPage / @totalPages</span>

        @if (currentPage < totalPages)
        {
            <a asp-action="Index" asp-route-page="@(currentPage + 1)" class="page-btn">Sau »</a>
        }
    </div>

    <!-- 🔹 Nút thêm -->
    <div class="add-section">
        <a asp-action="Add" class="btn btn-add">➕ Thêm chi tiết đơn hàng</a>
    </div>
</div>
